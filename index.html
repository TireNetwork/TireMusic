<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <title>TireMusic</title>
     <style>
        h1 {
            font-family: arial;
            position: fixed;
            bottom: 0;
            left: 0;
            color: grey;
            font-size: 50px;
            margin: 0;
            padding: 10px;
            z-index: 1000;
        }
        #status {
            color: grey;
            font-family: arial;
        }
        body {
            background-color: black;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        .audio-container {
            width: 300px;
            text-align: center;
        }
        button {
            color: black;
            background-color: grey;
            border-radius: 25px;
            width: 300px;
            height: 50px;
            margin: 10px;
            cursor: pointer;
        }
        .visualizer {
            background-color: white;
            height: 20px;
            margin-top: 20px;
            position: relative;
            border: 1px solid grey;
            border-radius: 20px;
        }
        .bar {
            background-color: grey;
            height: 19px;
            width: 0;
            border-radius: 20px;
        }
        #playPauseBtn {
            margin: 20px auto;
            display: block;
            width: 80px;
        }
        #buttons {
            position: absolute;
            top: 0;
            left: 0;
        }
    </style>
    <h1>TireMusic</h1>
    <div class="audio-container">
        <audio id="audio" src="" preload="auto"></audio>
        <div id="buttons"></div>
        <div class="visualizer">
            <div class="bar"></div>
        </div>
        <button id="playPauseBtn" onclick="togglePlayPause()">pause</button>
        <div id="status"></div>
    </div>

 <script>
        const audio = document.getElementById("audio");
        const playPauseBtn = document.getElementById("playPauseBtn");
        const bar = document.querySelector(".bar");
        const status = document.getElementById("status");
        const buttonsDiv = document.getElementById("buttons");

        let isPlaying = false;
        let songs = [];

        // Function to check if the IP address matches
        function checkIPAddress() {
            // Assuming you have a function to get the user's IP address
            const userIPAddress = "192.168.1.50"; // Replace this with the actual IP address

            // Check if the IP address matches
            if (userIPAddress === "192.168.1.50") {
                const addSong = confirm("Do you want to add a song?");
                if (addSong) {
                    const title = prompt("Enter the title of the song:");
                    const author = prompt("Enter the author of the song:");
                    const url = prompt("Enter the URL of the song:");
                    if (title && author && url) {
                        // Add the new song to the songs array
                        const newSong = { title, author, url };
                        songs.push(newSong);
                        // Add a new button for the added song
                        const button = document.createElement("button");
                        button.textContent = `Play ${title} by ${author}`;
                        button.onclick = () => playSong(newSong);
                        buttonsDiv.appendChild(button);
                        alert("Song added successfully!");
                        // Update the songs.json file on GitHub
                        updateSongsJSON(songs);
                    } else {
                        alert("Invalid input. Song not added.");
                    }
                }
            }
        }

        // Function to update the songs.json file on GitHub
        function updateSongsJSON(songs) {
            const username = 'wheels522';
            const repository = 'tiremusic';
            const branch = 'main';
            const filePath = 'songs.json';
            const accessToken = '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'; // Replace with your GitHub access token

            const apiUrl = `https://api.github.com/repos/${username}/${repository}/contents/${filePath}`;

            fetch(apiUrl, {
                method: 'GET',
                headers: {
                    'Authorization': `token ${accessToken}`,
                },
            })
            .then(response => response.json())
            .then(data => {
                const content = btoa(JSON.stringify(songs, null, 2)); // Encode content to base64
                const updateUrl = `${apiUrl}?ref=${branch}`;
                const body = {
                    message: 'Add new song',
                    content: content,
                    sha: data.sha,
                };

                return fetch(updateUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${accessToken}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(body),
                });
            })
            .then(response => {
                if (response.ok) {
                    console.log('Songs JSON file updated successfully.');
                } else {
                    console.error('Failed to update songs JSON file:', response.statusText);
                }
            })
            .catch(error => console.error('Error updating songs JSON file:', error));
        }

        // Function to play a song
        function playSong(song) {
            audio.src = song.url;
            audio.play();
            isPlaying = true;
            playPauseBtn.textContent = "pause";
            status.textContent = `Playing: ${song.title} by ${song.author}`;
        }

        // Function to toggle play/pause
        function togglePlayPause() {
            if (isPlaying) {
                audio.pause();
                isPlaying = false;
                playPauseBtn.textContent = "play";
                status.textContent = "";
            } else {
                audio.play();
                isPlaying = true;
                playPauseBtn.textContent = "pause";
                const currentSong = songs.find(song => song.url === audio.src);
                status.textContent = currentSong ? `Playing: ${currentSong.title} by ${currentSong.author}` : "";
            }
        }

        // Event listener for timeupdate
        audio.addEventListener("timeupdate", () => {
            const currentTime = audio.currentTime;
            const duration = audio.duration;
            const progress = (currentTime / duration) * 100;
            bar.style.width = `${progress}%`;
        });

        // Event listener for ended
        audio.addEventListener("ended", () => {
            isPlaying = false;
            playPauseBtn.textContent = "play";
            status.textContent = "";
        });

        // Check the IP address when the page loads
        checkIPAddress();
    </script>
